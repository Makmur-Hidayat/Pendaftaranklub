<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    /* CSS Sederhana untuk Tampilan */
    body { font-family: Arial, sans-serif; background-color: #f4f4f4; padding: 20px; }
    .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { color: #333; text-align: center; }
    form { display: grid; grid-template-columns: 1fr; gap: 15px; }
    label { font-weight: bold; margin-bottom: 5px; display: block; }
    input[type="text"], input[type="email"], input[type="date"], textarea {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;
    }
    button { 
      background-color: #007bff; color: white; padding: 10px 15px; border: none; border-radius: 4px; 
      cursor: pointer; font-size: 16px; margin-top: 10px; 
    }
    button:hover { background-color: #0056b3; }
    .message { padding: 10px; border-radius: 4px; margin-top: 15px; text-align: center; font-weight: bold; }
    .success { background-color: #d4edda; color: #155724; border-color: #c3e6cb; }
    .error { background-color: #f8d7da; color: #721c24; border-color: #f5c6cb; }

    /* Gaya Tabel */
    #hasilData { margin-top: 30px; }
    #dataKlubTable { width: 100%; border-collapse: collapse; margin-top: 15px; }
    #dataKlubTable th, #dataKlubTable td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    #dataKlubTable th { background-color: #f2f2f2; }
    .data-row:nth-child(even) { background-color: #f9f9f9; }
    .data-row td:last-child { max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; } /* Untuk membatasi tampilan URL */

  </style>
</head>
<body>

<div class="container">
  <h2>Formulir Pendaftaran Klub</h2>
  <div id="statusMessage" class="message" style="display: none;"></div>

  <form id="clubRegistrationForm">
    <label for="namaKlub">Nama Klub:</label>
    <input type="text" id="namaKlub" name="namaKlub" required>

    <label for="julukan">Julukan:</label>
    <input type="text" id="julukan" name="julukan" required>

    <label for="tanggalBerdiri">Tanggal Berdiri (DD-MM-YYYY):</label>
    <input type="date" id="tanggalBerdiri" name="tanggalBerdiri" required>

    <label for="alamatKlub">Alamat Klub:</label>
    <textarea id="alamatKlub" name="alamatKlub" rows="3" required></textarea>

    <label for="noTelponKlub">No Telpon Klub (+62 format):</label>
    <input type="text" id="noTelponKlub" name="noTelponKlub" pattern="^\+62[0-9]{8,15}$" placeholder="+6281234567890" required>
    
    <label for="emailKlub">Email Klub:</label>
    <input type="email" id="emailKlub" name="emailKlub" placeholder="sikerei@gmail.com" required>

    <label for="logoKlubUrl">Logo Klub (URL Gambar PNG/JPG/JPEG, maks 200kb - *URL link langsung*):</label>
    <input type="url" id="logoKlubUrl" name="logoKlubUrl" required>

    <button type="submit" id="submitBtn">Daftar Klub</button>
  </form>

  <hr>

  <div id="hasilData">
    <h3>Data Klub yang Sudah Terdaftar (Read Only)</h3>
    <table id="dataKlubTable">
      <thead>
        <tr>
          <th>Nama Klub</th>
          <th>Julukan</th>
          <th>Tanggal Berdiri</th>
          <th>Alamat Klub</th>
          <th>No Telpon</th>
          <th>Email</th>
          <th>Logo (URL)</th>
        </tr>
      </thead>
      <tbody>
        </tbody>
    </table>
  </div>
</div>

<script>
  // JavaScript untuk Interaksi Formulir dan Tampilan Data
  
  const form = document.getElementById('clubRegistrationForm');
  const statusMessage = document.getElementById('statusMessage');
  const submitBtn = document.getElementById('submitBtn');
  const dataTableBody = document.querySelector('#dataKlubTable tbody');

  // Menampilkan pesan sukses/gagal
  function showMessage(type, text) {
    statusMessage.style.display = 'block';
    statusMessage.className = `message ${type}`;
    statusMessage.innerText = text;
  }

  // Mengubah format tanggal dari YYYY-MM-DD (HTML input type date) menjadi DD-MM-YYYY
  function formatTanggal(dateString) {
    if (!dateString) return '';
    const [year, month, day] = dateString.split('-');
    return `${day}-${month}-${year}`;
  }

  // Menangani submit formulir (Create)
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    submitBtn.disabled = true;
    submitBtn.innerText = 'Memproses...';
    statusMessage.style.display = 'none';

    const formData = new FormData(form);
    const dataKlub = {};
    for (const [key, value] of formData.entries()) {
      dataKlub[key] = value;
    }
    
    // Format tanggal ke DD-MM-YYYY sebelum dikirim ke GAS
    dataKlub.tanggalBerdiri = formatTanggal(dataKlub.tanggalBerdiri);
    
    // Panggil fungsi Apps Script untuk menyimpan data
    google.script.run
      .withSuccessHandler(handleSuccess)
      .withFailureHandler(handleError)
      .simpanData(dataKlub);
  });

  // Callback saat Apps Script berhasil
  function handleSuccess(response) {
    submitBtn.disabled = false;
    submitBtn.innerText = 'Daftar Klub';
    
    showMessage(response.success ? 'success' : 'error', response.message);

    if (response.success) {
      // Sembunyikan formulir setelah pendaftaran berhasil (Input Satu Kali)
      form.style.display = 'none';
      
      // Muat ulang data untuk menampilkan data baru
      muatDataKlub();
    }
  }

  // Callback saat Apps Script gagal
  function handleError(error) {
    submitBtn.disabled = false;
    submitBtn.innerText = 'Daftar Klub';
    showMessage('error', 'Terjadi kesalahan pada server: ' + error);
  }

  // Fungsi untuk memuat dan menampilkan semua data klub (Read)
  function muatDataKlub() {
    dataTableBody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Memuat data...</td></tr>';
    
    // Panggil fungsi Apps Script untuk membaca data
    google.script.run
      .withSuccessHandler(tampilkanData)
      .withFailureHandler(handleError)
      .bacaData();
  }

  // Menampilkan data yang diterima dari Apps Script
  function tampilkanData(data) {
    dataTableBody.innerHTML = '';
    
    if (data.length === 0) {
      dataTableBody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Belum ada klub yang terdaftar.</td></tr>';
      return;
    }

    data.forEach(row => {
      const tr = document.createElement('tr');
      tr.className = 'data-row';
      
      // Urutan kolom di Apps Script: 
      // [Nama Klub, Julukan, Tanggal Berdiri, Alamat Klub, No Telpon Klub, Email Klub, Logo Klub (URL)]
      
      // Karena tanggal sudah diformat di Apps Script, kita tinggal tampilkan
      tr.innerHTML = `
        <td>${row[0]}</td>
        <td>${row[1]}</td>
        <td>${row[2]}</td>
        <td>${row[3]}</td>
        <td>${row[4]}</td>
        <td>${row[5]}</td>
        <td><a href="${row[6]}" target="_blank" title="${row[6]}">Link Logo</a></td>
      `;
      dataTableBody.appendChild(tr);
    });
  }

  // Muat data saat halaman pertama kali dibuka
  window.onload = muatDataKlub;
  
</script>

</body>
</html>
